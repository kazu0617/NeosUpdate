**2021.3.23.231**
皆さん、こんにちは。このビルドの準備に時間がかかってしまいましたが、このビルドは新しいデスクトップモードの開発における重要な布石となります。コンテキストメニューと装備可能なアイテム(ツール、武器、ガジェットなど）を完全に使用できるようになり、このモードはコアなインタラクションに完全に使用できるようになりました。これらが揃ったところで、これをデフォルトのデスクトップモードにする作業を始めます。もっと洗練されたものになるまでの間は、古いものをレガシーとして残しておきます。今のところ、このモードを有効にするには、VRを起動してF8を押す必要がありますが、すでに非常に便利であることが証明されていることを願っています。

内部的に変更/拡張された準主要な点がいくつかあります。入力処理がかなり再構築され、いくつかの入力処理のレイテンシーが1フレーム短縮されました(より反応が良くなっています）が、潜在的な副作用に注意してください。本番稼動前にゲームを破壊するようなバグを発見してくれた、テスターの方々に感謝します。`/home/JellyOsaurusPC`, `Kulza`, `Raith (CytraX)`, `Alex the pet peeve avali 🐦`, `Epsilion`, `Gawdl3y`, `Shadow Panther [RU/EN, UTC+3]`。

このビルドにはたくさんの調整、セキュリティの改善、修正が含まれていますので、皆さんが抱えている痛みや問題が解決されることを願っています。これらの修正が滞っていたのは残念です！すぐに、おそらく明日にはもっと準備できると思います。ウィークリーアップデートも今日ではなく明日にしなければならないかもしれません。これを準備するのに予想以上に時間がかかってしまい、いつまで起きて集中できるかわかりません。

でも、それまでの間、楽しんでください。デスクトップにはまだまだたくさんの機能がありますが、これで必要な基本機能はすべてそろったはずです。

**新機能(New Features)**:
- コンテキストメニューが新しいデスクトップモードで使用できるようになりました。
-- マウスの中ボタンまたはゲームパッドのYボタンで開閉できます。
-- 特定のオブジェクト(アバターやツールチップ/Equippableアイテムなど）をクリックしたときにも開くようになりました。
-- コンテキストメニューが開いているときは、カーソルが自由形状に切り替わり、アイテムに頭を向けなくても簡単に選択したりクリックしたりすることができます。

- ツール、ガジェット、その他の装備可能なアイテムが新しいデスクトップモードで使用可能になりました。
-- 装備すると、アバターの手が頭に対して相対的に配置され、一人称モードでもアイテムが見えるようになります。
--- 位置はグリップのポーズに基づいています。正しく設定されていないと、アイテムの位置がずれてしまいます。
-- ツール/アイテム/ガジェットは、カーソルのレティクルの下にある世界のポイントに自動的に向けられます。
--- これが正しく機能するためには、アイテムは適切に設定された `TipReference` を持つ必要があり、それはツールが目指すべき正確な先端と方向に対応しています(Z軸を前方として使用）。
--- 既存の `RawDataTooltip` アイテムは、レイキャストやパーティクルのソースを使った自動検知を行い自動アップグレードされます。検知がうまくいかない場合は、手動で `TipReference` を調整する必要があるかもしれません。
-- 現在のバインディングは以下の通りです(これらは暫定的なものであり、変更される可能性があります）。
--- プライマリ - マウスの左ボタン / 右トリガー (ゲームパッド)
--- セカンダリー - Rキー / マウスボタン4(ある場合） / Xボタン(ゲームパッド

- `RawDataTooltip` と `StandardController` がデスクトップモードで適切な入力を提供するようになり、これらに依存するアイテムが動作するようになりました。
-- 値は、対応するアクションの現在の入力バインディングから `VirtualController` タイプに供給されます。

- ポインタインタラクションシステムでは、1つ目と2つ目のポインタ(マウスカーソルやタッチ）がハンドインタラクションシステムを経由するようになりました。
-- これにより、相互作用がアバターのプライマリハンドとセカンダリハンドのポーズをとり、タッチスクリーンで掴んだり拡大縮小したりできるようになりました。
- Neosは、フリーフォームカーソルモードでも独自のカーソルをレンダリングするようになりました。これにより、視覚的な一貫性とコンテキストに沿った動作を実現し、システムカーソルがゲーム内のレティクルの上に重なってしまうことを防ぎます。
- `InputDeviceStreamDriver` が、現在非アクティブな入力デバイスのストリームを無効にし、ネットワークの帯域幅を節約するようになりました。
-- 例：ScreenがアクティブなときはVRコントローラ、VRがアクティブなときはVirtualControllers

- 聴覚障害者バッジ、色覚障害者バッジ、ミュートバッジ、ポテトバッジを自分で割り当てることができるようになりました。
-- 聴覚障害者バッジ、色覚障害者バッジ、ミュートバッジ、ポテトバッジを自分で割り当てられるようになりました。
-- `/addHearingImpaired`, `/removeHearingImpaired`, `/addColorBlind`, `/removeColorBlind`, `/addMute`, `/removeMute`, `/addPotato`, `/removePotato`

Tweaks:
- 入力処理コンポーネント、アバターポザー、`VRIK`、`CommonTool` の更新順序を再構築しました。
-- これにより、入力応答のレイテンシーを1フレーム短縮しました(例：レーザー／カーソルの応答を1フレーム遅れではなく、入力があったのと同じフレームで行うようにしました）。
-- また、レーザーのヒットに基づいて自動的にインタラクションを行うことができます(例えば、瞬時に行われるスクリーンタッチに基づいて）。
- デスクトップモードでの掴み取りは、手ではなくユーザーの頭の前方向を回転基準として使用するようになりました。
-- これにより、プロシージャルに動かされた手によって、掴まれたオブジェクトがわずかに回転するのを防ぐことができます。
- 入力やトラッキング補正などに基づいてルートオブジェクトを上書きするための、いくつかのユーザー関連コンポーネントの整理と調整を行いました。
-- 多くのコンポーネントは、明示的に割り当てられるのではなく、初期化されたユーザーに基づいて暗黙的に動作するようになりました。
-- コンポーネントは、可能な限り、すべてのユーザーではなく、実際に使用しているユーザーのイベントのみを登録します。
- アセットタイプを分類する際のURLの解析を改善し、メインデータのパスに加えてファイルの拡張子をURLクエリで検索するようになりました。
-- これにより、特定のタイプのURLが適切に検出され、クリップボードから直接インポートされるようになりました(例：Komdog氏が報告したIPFSファイルのURL）。
-- 例えば、https://example.com/somepath?file=MyFile.mp4&someparam=42 はビデオとして正しくインポートされます。
- デスクトップモードで、頭に近い位置にある手のジェスチャー/ショートカットがトリガーされなくなった
- 新しいデスクトップモードがアクティブな場合、Ctrl+Sでのワールドの保存が抑制されるようになりました(Cyroの報告に基づく）。
- ゲームパッドの左バンパーにクラウチが表示されるようになった

セキュリティ
- `SimpleAvatarProtection` が破壊されたユーザーをチェックする際に例外を投げていた問題を修正 (based on report by 3x1t_5tyl3 and marsmaantje)
- `CommonAvatarBuilder` がユーザーのデフォルトアバターを何らかの理由で装備できなかった場合にクリーンアップしない問題を修正(3x1t_5tyl3氏とmarsmaantje氏の報告による。
- タッチソースのセキュリティを向上させた(PsychpsyoとEpsilionの報告とサンプルに基づく）。
- ユーザースペースで転送されるホールドアイテムのサニタイズの改善(PsychpsyoとEpsilionの報告とサンプルに基づく
- ユーザースペースのみのコンポーネントをクリーンアップするメカニズムを見直し、保護されたスロット(例：Rootスロット）に配置しても例外が発生せず、クリーンアップに失敗しないようにした(Psychpsyo氏の報告による。
- ワールドUIとワールドオーブでユーザー名がサニタイズされず、ユーザー名のRTFタグが解析されてしまう問題を修正(by Kodey and Psychpsyo)

**バグ修正**:
- VRモードで動作しているときにNeosがカーソルをロックしていたのを修正(reported by Hayden)
- ビヘイビアを与えられたユーザーのみが実行すべきアクションをヘッドレスで実行していたのを修正
- 一部のコンポーネントでBeforeInputUpdateイベントが2回実行されることがあった問題を修正
- SmirkLeftおよびSmirkRight式が有効になると `AvatarExpressionDriver` が壊れてしまう問題を修正しました。 (reported by Alex the pet peeve avali 🐦)
- `ContextMenuのコライダーが最初に使われるまで有効になっていたのを修正
- 新しいデスクトップモードと古いデスクトップモードを併用した際のいくつかの奇妙な動作を修正
- ScreenControllerの更新順序がTrackedDevicePositionerと同じであるため、シミュレートされた手が異常になるケースがあった問題を修正 (where it ends up initialized after the TrackedDevicePositioner)
- `ValueField<T>` やその他の値型を扱う汎用コンポーネントが特定の非値型(例：System.Type）を許可し、セッションがクラッシュする原因となっていたのを修正(dfgHiatus, Epsilion, Psychpsyo, Zyzyl により報告された）。
- 破壊保護されたスロットに配置されたときにコンポーネントの例外処理がおかしくなる問題を修正しました(Psychpsyoによるフィードバックに基づく
- マウスが存在しないデバイス(例：Android）でNeosがクラッシュする問題を修正(かず(kazu / GitHub: kazu0617）さんの報告に基づく）。
- 信頼性の高いユーザー配置が壊れたり、プロセスの途中でユーザーが削除されると例外が発生し、他のプロセスが壊れる問題を修正(usu. based on report by 3x1t_5tyl3 and marsmaantje)
- 無効な引数でコンポーネントを作成したときのクラッシュを防ぐため、より多くのコンポーネントに汎用型検証を追加しました(ZyzylとBanane9の調査に基づく）。
- いくつかのWorldイベントの動作(フォーカス変更、保存時、ユーザーの参加または離脱など）が、適切な更新スコープを設定していないために発生する問題を修正しました(フィールドが駆動されている場合など）。
- SyncTypeの設定と関連する操作にタイプ検証を追加しました。無効なタイプ(例：無効なジェネリック引数を持つタイプ）の設定/処理でセッションがクラッシュするのを防ぎます(Psychpsyo氏により報告されました）。
- `AvatarExpressionDriver` の `LipMoveLeftLower` 式がターゲットを左ではなく右に動かすように修正された(reported by umbran)
- ネームプレートが `IsPresent` ではなく `IsPresentInHeadset` 状態を使用していて、ヘッドセットを装着した後にデスクトップモードに切り替えると半透明になってしまう問題を修正(reported by Shifty | Quality Control Lead)
- Fixed Userspace に PointerInteractionControllerのインスタンスが2つあり、ユーザースペースでのカーソルとタッチのインタラクションが2重に処理されてしまう問題を修正.

**既知の問題**:
- ゲームパッドでコンテキストメニューを操作する際、メニューが消える前に手を離さないとカメラビューが移動してしまう
- ツールチップの中には、追加のビヘイビアがないと使いにくいものがある(例：LogiX tooltip)
- 現在、キーバインディングは暫定的なものであり、ビヘイビアが追加されると調整される可能性があります。

**2021.3.23.263**
特にOculusのランタイムでセッションがクラッシュすることがあるため、迅速な修正を行いました。以前のビルドと互換性があります。問題がなければアップデートする必要はありません(ローカルにしか影響しません）。

**2021.3.23.391**
さらに見つかった問題を修正するための追加のHotfixです。以前のビルドとの互換性はありますが、主にヘッドレスで発生するバグに関するものなので、ヘッドレスでのアップデートを推奨します。

Tweaks:
- MirPASECによる韓国語ロケールの翻訳をマージ(新しいMTCアバターロビーを含む）(HotFix in 2021.3.23.391)

**バグ修正**:
- NeosがVRバインディングをVRではなくVirtualControllerに使おうとして、ユーザーのセッションがクラッシュするケースがあったのを修正(HotFix in 2021.3.23.263)。
-- これにより、特にOculusのランタイムで、デスクトップでワールドに参加したりロコモーションを切り替えたりしたときのセッションクラッシュが修正されるはずです(報告 epicEaston197, Shifty | Quality Control Lead, /home/JellyOsaurusPC)
- 入力更新サイクルで削除されたオーナーのためにInputGroupsを更新することによる例外を修正(HotFix in 2021.3.23.391)
- グラボの変換計算を、実際にグラボを所有しているユーザではなく、ローカルユーザの空間を使って行うように修正(HotFix in 2021.3.23.391)
-- これにより、CommonToolのヘッドレスで、ユーザールートがないことによる例外も修正(HotFix in 2021.3.23.391)
- VRIKAvatarで頭の位置が利用可能な場合に、ユーザーの頭までの距離を計算しようとする問題を修正 (e.g. during respawn or on headless)(HotFix in 2021.3.23.391)
-- IKアバターがヘッドレス時に終了すると更新されなくなる問題を修正しました(HotFix in 2021.3.23.391)